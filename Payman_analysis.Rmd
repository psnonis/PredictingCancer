#' ---
#' title: "W203 Lab 1, Cancer EDA"
#' author: "Payman 'Roghani"
#' date: "8/16/2018"
#' ---

---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

In this project our efforts are focused on the analysis of data included in the csv file provided, to primarily understand the potential relationship between different parameters and the incidences of cancder across counties in the US. The main objectives are:
* To understand factors that predict cancer mortality rate, with the ultimate aim of identifying communities for social interventions.
* To determine which interventions are likely to have the most impact.


## Data
(Question: Do we need to explain every step? Or the codes are supposed to be self-explanatory?)

```{r}
Cancer <- read.csv('cancer.csv')
head(Cancer)
```

```{r}
summary(Cancer)
str(Cancer)
```

```{r}
colnames(Cancer)
```


```{r}
nrow(Cancer)
ncol(Cancer)
```

The cancer.csv file 29 variables (30 columns, including the first one that has the number of observations) and 3047 observations, where each observation (i.e. row) includes data for a county across the US. The varaiblaes are mostly numbers and integers, except for 2 thar factors (binnedInc and Geography). Below, we have explain the variables in detail and provide our assessment of the quality of the data.  

>>> data on smoking and obesity and other cancer risk factors could've been very helpful

**Variables**

* avgAnnCount: The average number of new cancer cases per year per county for years 2009-2013
* medIncome: Median income per county
* popEst2015: Estimated population by county 2015
* povertyPercent: Percent of population below poverty line
* binnedInc: ???
* MedianAge: Median age per county
* MedianAgeMale: Median age among males per county    
* MedianAgeFemale: Median age among females per county  
* Geography: Counyt, State
* AvgHouseholdSize: Average household size per county
* PercentMarried: Percentage of marreid population
* PctNoHS18_24: Percentage of 18-24 year old population with no high school education
* PctHS18_24: Percentage of 18-24 year old population with high school education
* PctSomeCol18_24: Percentage of 18-24 year old population with some college education
* PctBachDeg18_24: Percentage of 18-24 year old population with bachelor's degree 
* PctHS25_Over: Percentage of population above 24 years old with high school education
* PctBachDeg25_Over: Percentage of population above 24 years old with bachelor's degree 
* PctEmployed16_Over: Percentage of population above 15 years old who have jobs
* PctUnemployed16_Over: Percentage of population above 15 years old with no jobs
* PctPrivateCoverage: Percentage of the population with private insurance coverage
* PctEmpPrivCoverage: ercentage of the population with employer-sponsored insurance coverage
* PctPublicCoverage: Percentage of the population with public insurance coverage
* PctWhite: Percentage of white population by county
* PctBlack: Percentage of African-American population by county
* PctAsian: Percentage of Asian population by county
* PctOtherRace: Percentage of other races by county
* PctMarriedHouseholds: Percentage of married hoseholds per county
* BirthRate: Birth rate per county
* deathRate: Death rate per county       

**Our obeservations**

Evaluate the data quality. Are there any issues with the data? Explain how you handled these potential issues.
Explain whether any data processing or preparation is required for your data set.


* While the cancer incidence rate is the mean for years 2003-2009, the population by county is for 2015 and other variables do not have date stamps. Ideally all variables should have been from the same time period.
* There is no definition for incidence rate per county for the avgAnnCount variable. We wil assume the numbers indicate....
* The binnedInc variable has 10 levels that seem arbitrary. It is not clear why the income bins have been defined this way.
* The maximum median age shows a value of 624, which is clearly a wrong number. We actually identified a total of 30 values in this column that are above 100; therefore, we will replace such values with NA in our analysis.
* The minimium average household size is 0.0221, which does not make sense, since we don't expect a houshold size below 1. There are 61 values in this column that are below 1, which we will replace with NA in our analysis.  
* The PctSomeCol18_24 variable has too many NA values (2285 out 3047). We will need to take this into account during our analysis. 
* It is not clear how the birth rate is caculated and what exactly BirthRate represents. Often, the birth rate is defined as childbirths per 1,000 people each year, but applying that here would not give us the right number. For example in Los Angeles County with the population of 10,170,292, there were 124,641 live biths in 2015, which translates into a birth rate of 12.25 (BR = (b รท p) X 1,000). However, the birth rate in our data shows a value of 4.7, which is probably the ratio of women aged 15-50 years old who gave birth in 2015 (source: http://www.towncharts.com/California/Demographics/Los-Angeles-County-CA-Demographics-data.html)
* Based on our assessment, we beliege the deathRate variable should represent the number of deaths due cancer per 100,000 population per county. We looked at the figure for Kings County, NY (173.6) and the number in our data is closer to cancer death rate (140.3), as opposed to overal death rate (603.1).
* PctEmpPrivCoverage is a subset of PctPrivateCoverage
* Overlap between public and private insurance

```{r}
#compare with CDC and cancer.gov
#also explain the "1962.667684" values
sum(Cancer$avgAnnCount)
```



```{r}
which(Cancer$popEst2015 > 10000000)
Cancer[1000,]
```
```{r}
#LA County birth rate. Formula: BR = (b รท p) X 1,000
124641/10170292*1000
```

```{r}
#Kings County, NY
Cancer[388,]
```


```{r}
#Kings County, NY
# 2015 population: 2,673,000
# 2015 death rate (per 100,000 population): 603.1
# 2015 Cancer death rate (per 100,000 population): 140.3
# Sources: DATA USA https://datausa.io/, NY State Dpt of Health https://www.health.ny.gov/
```


```{r}
#checking if there are duplicates in counties. 
length(unique(Cancer[["Geography"]]))
```
The number of rows equals the number of unique counties, so there is no duplicates.

```{r}
age_error = subset(Cancer, MedianAge > 100)
nrow(age_error)
```

```{r}
#does mean household size < 1 make sense?
household_error = subset(Cancer, AvgHouseholdSize < 1)
nrow(household_error)
```

```{r}
#checking the number of values above 100 in the MedianAge column
Cancer$MedianAge[Cancer$MedianAge > 100] = NA
```

```{r}
#checking the number of values below 1 in the AvgHouseholdSize column
Cancer$AvgHouseholdSize[Cancer$AvgHouseholdSize < 1] = NA
```

```{r}
library(dplyr)
library(tidyr)
```

```{r}
#adding 2 separate columns for County and State, in order to State-wide analysis of the data
Cancer2 <- Cancer %>% separate(Geography, c("County", "State"), sep = ",", remove = FALSE)
```


```{r}
#cheking for potentially erroneous values in avgAnnCount
sum(Cancer2$avgAnnCount > Cancer2$popEst2015, na.rm = TRUE)
```


```{r}
Cancer2$avgAnnCount[Cancer2$avgAnnCount == 1962.667684] <- NA
Cancer2$incidenceRate <- Cancer2$avgAnnCount / Cancer2$popEst2015 * 100000
```

```{r}
sum(Cancer2$avgAnnCount > Cancer2$popEst2015, na.rm = TRUE)
```

```{r}
colnames(Cancer2)
#summary(Cancer2)
#str(Cancer2)
```

```{r}
Cancer2$Pct_insured <- Cancer2$PctPrivateCoverage + Cancer2$PctPublicCoverage
Cancer2$Pct_PersonalIsure <- Cancer2$PctPrivateCoverage - Cancer2$PctEmpPrivCoverage
```


```{r}
library(car)
```

```{r}
scatterplotMatrix( ~ incidenceRate + deathRate +
                   + PctPrivateCoverage + PctEmpPrivCoverage + PctPublicCoverage
                   ,diagonal=list(method="histogram"), 
                   data = Cancer2, main = "Scatterplot Matrix to Understand the Impact of Insrance Coverage")
```



```{r}
# scatterplotMatrix( ~ avgAnnCount + medIncome + povertyPercent + binnedInc
#                    + MedianAge + PctPrivateCoverage + PctEmpPrivCoverage 
#                    + PctPublicCoverage,diagonal=list(method="histogram"), 
#                    data = Cancer2, main = "Scatterplot Matrix for Key Cancer Data Variables")
```

```{r}
cor(Cancer2[ , c("incidenceRate", "deathRate",
                 "PctPrivateCoverage", "PctEmpPrivCoverage", "PctPublicCoverage")], 
                  use = "complete.obs")
```



```{r}
insurance_error = subset(Cancer2, Pct_insured > 100)
nrow(insurance_error)
```




